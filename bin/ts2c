#!/usr/bin/env node
var path = require('path');
var fs = require('fs');
var ts = require('typescript');
var ts2c = require(path.join(__dirname, "..", "ts2c.js"));
var ts2cprogram = require(path.join(__dirname, "../src/", "program.js"));

if (process.argv.length < 2)
    process.exit();

var fileNames = [], params = {};
process.argv.slice(2).forEach(p => p.indexOf('--') == 0 ? params[p.slice(2)] = true: fileNames.push(p));

var program = ts.createProgram(fileNames, { noLib: true, allowJs: true });

global.ts2cOptions = params;
var output = new ts2cprogram.CProgram(program, params)["resolve"]();
fs.writeFileSync(fileNames[0].slice(0, -3) + '.c', output);

process.exit();
